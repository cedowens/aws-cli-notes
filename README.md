# aws-cli-notes
A combined list of helpful awscli commands from Scott Piper's flaws.cloud exercise. 

AWS Flaws.cloud link: http://flaws.cloud/.

A sample shared credentials [file](credentials), to propely set up profiles for aws cli.

Commands below are listed in order of the exercises:

1. do DNS lookup on the domain you are investigating (ex: **dig [domain.com]**)

2a. navigate to the IP(s) the domain resolves to in your browser and see if you are redirected to **https://aws.amazon.com/s3/**, which would indicate that it is an S3 bucket.

2b. if you are not redirected to **https://aws.amazon.com/s3/** but the website returns a page with CloudFront references, then you know that the domain is hosted in AWS. An example would be a 403 Error with a message showing "Generated by cloudfront (CloudFront)"

3. then run an nslookup on the IP (ex: **nslookup [IP]**)

3b. If the host is an S3 bucket and has been configured for web hosting, you may see the hostname being on amazonaws.com and the region might also referenced in the hostname returned.

3c. If the host is in AWS but is not a bucket, you may see cloudfront.net in the hostname.

3d. common aws url: **http://[domain].s3.amazonaws.com**

3e. you can also view the url using the aws cli:  **aws s3 ls s3://[bucket name]** (can also include **--profile [profile]** as the first arguments if you want to use a specific profile)

NOTE: cyberduck can also browse a bucket and will determine the region for you

4. downloading s3 buckets: **aws s3 sync s3://[bucket] [local_dir]** (or can also copy certain items from buckets locally using **aws s3 cp s3://[bucket]/dir [local_dir]**

5. configure a new aws profile locally: **aws configure --profile [new_profile_name]**

6. **aws --profile [profile_name] get-caller-identity** --> find account ID and name of the account

7. **aws --profile [profile_name] ec2 describe-snapshots --owner-id [ownerID]** --> look for ec2 snapshot info

8. **aws --profile [profile_name] ec2 create-volume --availability-zone [zone] --region [region] --snapshot-id [ID]** ---> create a volume using the snapshot and then ssh into it

9. **find /mnt -type f -mtime -1 2>/dev/null | grep -v "/var/" | grep -v "/proc/" | grep -v "/dev/" | grep -v "/sys/" | grep -v "/run/" | less**  --> look for creds

10. "On cloud services, including AWS, the IP **169.254.169.254** is magical. It's the metadata service."

11. **aws --profile [profile_name] iam get-user** --> find out who you are

12. **aws --profile level6 iam list-attached-user-policies --user-name Level6** --> find what policies are attached

13. **aws --profile [profile_name] iam get-policy --policy-arn [arn_value]**  ---> once you know the ARN for a policy, you can get the version id

14. **aws --profile [profile_name] iam get-policy-version --policy-arn [arn_value]** ---> see what the actual policy is

15. **aws --region [region] --profile [profile_name] lambda list-functions**  ---> if you have SecurityAudit policy, you can see some info on lambdas

16. **aws --region [region] --profile [profile_name] lambda get-policy --function-name [name]**  ---> additional info with rest api info

17. **aws --profile [profile_name] --region [region] apigateway get-stages --rest-api-id "[ID]"**  ----> get info on stage name and lambda function info





